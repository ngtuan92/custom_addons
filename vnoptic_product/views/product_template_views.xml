<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- ========================================== -->
    <!-- FORM VIEW - Inherit product.template form -->
    <!-- ========================================== -->
    <record id="product_template_form_view_vnoptic" model="ir.ui.view">
        <field name="name">product.template.form.vnoptic</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            
            <!-- Add product_type selection after name field in header -->
            <xpath expr="//div[@class='oe_title']" position="inside">
                <div class="o_row mt-2">
                    <label for="product_type" string="Loại SP"/>
                    <field name="product_type" widget="radio" options="{'horizontal': true}"/>
                </div>
            </xpath>
            
            <!-- Add VNOPTIC Information section in general tab -->
            <xpath expr="//page[@name='general_information']//group" position="after">
                <separator string="THÔNG TIN VNOPTIC" colspan="2"/>
                <group>
                    <group string="Thông tin cơ bản">
                        <field name="eng_name" string="Tên tiếng Anh" placeholder="English product name"/>
                        <field name="trade_name" string="Tên thương mại" placeholder="Commercial name"/>
                        <field name="group_id" string="Nhóm SP" 
                               options="{'no_create': True, 'no_open': True}"/>
                        <field name="unit" string="Đơn vị"/>
                        <field name="status_product_id" string="Trạng thái" 
                               options="{'no_create': True, 'no_open': True}"/>
                    </group>
                    <group string="Thương hiệu / NCC / Xuất xứ">
                        <field name="brand_id" string="Thương hiệu" 
                               options="{'no_create': True, 'no_open': True}"/>
                        <field name="supplier_id" string="Nhà cung cấp" 
                               options="{'no_create': True, 'no_open': True}"/>
                        <field name="country_id" string="Xuất xứ" 
                               options="{'no_create': True, 'no_open': True}"/>
                    </group>
                </group>
            </xpath>
            
            <!-- Add VNOPTIC custom tabs to notebook -->
            <xpath expr="//notebook" position="inside">
                
                <!-- Tab: Giá &amp; Thuế chi tiết -->
                <page string="Giá chi tiết" name="vnoptic_pricing">
                    <group>
                        <group string="Giá bán">
                            <field name="list_price" string="Giá bán lẻ (Retail)"/>
                            <field name="x_ws_price" string="Giá sỉ (Wholesale)"/>
                            <field name="x_ws_price_max" string="Giá sỉ tối đa"/>
                            <field name="x_ws_price_min" string="Giá sỉ tối thiểu"/>
                        </group>
                        <group string="Giá vốn &amp; Ngoại tệ">
                            <field name="currency_selection" string="Ngoại tệ"/>
                            <field name="x_currency_zone_value" string="Tỉ giá"/>
                            <field name="x_ct_price" string="Giá vốn (Cost)"/>
                            <field name="x_or_price" string="Giá nguyên tệ (Original)"/>
                        </group>
                    </group>
                    <group>
                        <group string="Thuế">
                            <field name="x_tax_percent" string="Thuế (%)"/>
                            <field name="currency_zone_id" string="Loại tiền" 
                                   options="{'no_create': True, 'no_open': True}"/>
                        </group>
                    </group>
                </page>
                
                <!-- Tab: Bảo hành -->
                <page string="Bảo hành" name="vnoptic_warranty">
                    <group>
                        <group string="Bảo hành cơ bản">
                            <field name="warranty_id" string="Bảo hành chính" 
                                   options="{'no_create': True, 'no_open': True}"/>
                            <field name="warranty_detail_id" string="Bảo hành chi tiết" 
                                   options="{'no_create': True, 'no_open': True}"/>
                        </group>
                        <group string="Bảo hành mở rộng">
                            <field name="warranty_retail_id" string="Bảo hành bán lẻ" 
                                   options="{'no_create': True, 'no_open': True}"/>
                            <field name="warranty_supplier_id" string="Bảo hành hãng" 
                                   options="{'no_create': True, 'no_open': True}"/>
                        </group>
                    </group>
                </page>
                
                <!-- Tab: Mô tả &amp; Hướng dẫn -->
                <page string="Mô tả &amp; Hướng dẫn" name="vnoptic_description">
                    <group>
                        <group string="Mô tả sản phẩm">
                            <field name="description" nolabel="1" placeholder="Nhập mô tả sản phẩm..."/>
                        </group>
                        <group string="Công dụng">
                            <field name="uses" nolabel="1" placeholder="Nhập công dụng..."/>
                        </group>
                    </group>
                    <group>
                        <group string="Hướng dẫn sử dụng">
                            <field name="guide" nolabel="1" placeholder="Hướng dẫn sử dụng..."/>
                        </group>
                        <group string="Cảnh báo">
                            <field name="warning" nolabel="1" placeholder="Cảnh báo an toàn..."/>
                        </group>
                    </group>
                    <group>
                        <group string="Bảo quản">
                            <field name="preserve" nolabel="1" placeholder="Hướng dẫn bảo quản..."/>
                        </group>
                    </group>
                </page>
                
                <!-- Tab: Chi tiết Lens (chỉ hiện khi product_type = lens) -->
                <page string="Thiết kế Lens" name="vnoptic_lens_design"
                      attrs="{'invisible': [('product_type', '!=', 'lens')]}">
                    <field name="lens_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}">
                        <tree editable="bottom" create="1" delete="1">
                            <field name="sph" string="SPH"/>
                            <field name="cyl" string="CYL"/>
                            <field name="len_add" string="ADD"/>
                            <field name="diameter" string="Đường kính"/>
                            <field name="prism" string="Prism"/>
                            <field name="base" string="Base"/>
                            <field name="design1_id" string="Thiết kế 1" options="{'no_create': True}"/>
                            <field name="design2_id" string="Thiết kế 2" options="{'no_create': True}"/>
                        </tree>
                        <form>
                            <sheet>
                                <group>
                                    <group string="Thông số quang học">
                                        <field name="sph" string="SPH"/>
                                        <field name="cyl" string="CYL"/>
                                        <field name="len_add" string="ADD"/>
                                        <field name="diameter" string="Đường kính"/>
                                        <field name="prism" string="Prism"/>
                                        <field name="base" string="Base Curve"/>
                                        <field name="axis" string="Axis"/>
                                    </group>
                                    <group string="Thiết kế">
                                        <field name="design1_id" string="Thiết kế 1" 
                                               options="{'no_create': True}"/>
                                        <field name="design2_id" string="Thiết kế 2" 
                                               options="{'no_create': True}"/>
                                    </group>
                                </group>
                            </sheet>
                        </form>
                    </field>
                </page>
                
                <!-- Tab: Chất liệu Lens -->
                <page string="Chất liệu Lens" name="vnoptic_lens_material"
                      attrs="{'invisible': [('product_type', '!=', 'lens')]}">
                    <field name="lens_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}" mode="tree">
                        <tree editable="bottom">
                            <field name="material_id" string="Vật liệu" options="{'no_create': True}"/>
                            <field name="index_id" string="Chiết suất" options="{'no_create': True}"/>
                        </tree>
                    </field>
                </page>
                
                <!-- Tab: Tích hợp Lens (UV, Coating...) -->
                <page string="Tích hợp Lens" name="vnoptic_lens_integration"
                      attrs="{'invisible': [('product_type', '!=', 'lens')]}">
                    <field name="lens_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}" mode="tree">
                        <tree editable="bottom">
                            <field name="uv_id" string="UV" options="{'no_create': True}"/>
                            <field name="cl_pho_id" string="Pho Col" options="{'no_create': True}"/>
                            <field name="cl_hmc_id" string="HMC" options="{'no_create': True}"/>
                            <field name="cl_tint_id" string="Tint Col" options="{'no_create': True}"/>
                            <field name="color_int" string="Độ đậm màu"/>
                            <field name="mir_coating" string="Màu tráng gương"/>
                            <field name="coating_ids" string="Coating" widget="many2many_tags" options="{'no_create': True}"/>
                        </tree>
                    </field>
                </page>
                
                <!-- Tab: Thông tin Gọng (OPT) -->
                <page string="Thông tin Gọng" name="vnoptic_opt_info"
                      attrs="{'invisible': [('product_type', '!=', 'opt')]}">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}">
                        <tree editable="bottom" create="1" delete="1">
                            <field name="season" string="Season"/>
                            <field name="sku" string="SKU"/>
                            <field name="model" string="Model"/>
                            <field name="serial" string="Serial"/>
                            <field name="color" string="Color Code"/>
                            <field name="oem_ncc" string="Mã gốc"/>
                        </tree>
                    </field>
                </page>
                
                <!-- Tab: Thiết kế Gọng -->
                <page string="Thiết kế Gọng" name="vnoptic_opt_design"
                      attrs="{'invisible': [('product_type', '!=', 'opt')]}">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}" mode="tree">
                        <tree editable="bottom">
                            <field name="frame_id" string="Kiểu gọng" options="{'no_create': True}"/>
                            <field name="gender" string="Giới tính"/>
                            <field name="frame_type_id" string="Loại gọng" options="{'no_create': True}"/>
                            <field name="ve_id" string="Ve" options="{'no_create': True}"/>
                            <field name="shape_id" string="Kiểu dáng mặt kính" options="{'no_create': True}"/>
                            <field name="temple_id" string="Chuôi càng" options="{'no_create': True}"/>
                        </tree>
                    </field>
                </page>
                
                <!-- Tab: Chất liệu Gọng -->
                <page string="Chất liệu Gọng" name="vnoptic_opt_material"
                      attrs="{'invisible': [('product_type', '!=', 'opt')]}">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}" mode="tree">
                        <tree editable="bottom">
                            <field name="materials_front_ids" string="Mặt trước" widget="many2many_tags" options="{'no_create': True}"/>
                            <field name="materials_temple_ids" string="Càng" widget="many2many_tags" options="{'no_create': True}"/>
                            <field name="material_temple_tip_id" string="Chuôi càng" options="{'no_create': True}"/>
                            <field name="material_lens_id" string="Mắt kính" options="{'no_create': True}"/>
                            <field name="material_ve_id" string="Ve kính" options="{'no_create': True}"/>
                            <field name="coating_ids" string="Lớp mạ" widget="many2many_tags" options="{'no_create': True}"/>
                        </tree>
                    </field>
                </page>
                
                <!-- Tab: Màu sắc Gọng -->
                <page string="Màu sắc Gọng" name="vnoptic_opt_color"
                      attrs="{'invisible': [('product_type', '!=', 'opt')]}">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}" mode="tree">
                        <tree editable="bottom">
                            <field name="color_front_id" string="Màu mặt trước" options="{'no_create': True}"/>
                            <field name="color_temple_id" string="Màu càng kính" options="{'no_create': True}"/>
                            <field name="color_lens_id" string="Màu mắt kính" options="{'no_create': True}"/>
                        </tree>
                    </field>
                </page>
                
                <!-- Tab: Kích thước Gọng -->
                <page string="Kích thước Gọng" name="vnoptic_opt_size"
                      attrs="{'invisible': [('product_type', '!=', 'opt')]}">
                    <field name="opt_ids" nolabel="1" context="{'default_product_tmpl_id': active_id}" mode="tree">
                        <tree editable="bottom">
                            <field name="temple_width" string="Dài gọng (mm)"/>
                            <field name="lens_width" string="Dài mắt (mm)"/>
                            <field name="bridge_width" string="Dài cầu (mm)"/>
                            <field name="lens_height" string="Cao mắt (mm)"/>
                            <field name="lens_span" string="Ngang mắt (mm)"/>
                        </tree>
                    </field>
                </page>
                
            </xpath>
        </field>
    </record>
    
    <!-- ========================================== -->
    <!-- TREE VIEW - Add VNOPTIC columns -->
    <!-- ========================================== -->
    <record id="product_template_tree_view_vnoptic" model="ir.ui.view">
        <field name="name">product.template.tree.vnoptic</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">
            <!-- Add fields after default_code -->
            <xpath expr="//field[@name='default_code']" position="after">
                <field name="brand_id" string="Thương hiệu" optional="show"/>
                <field name="supplier_id" string="Nhà cung cấp" optional="hide"/>
                <field name="country_id" string="Xuất xứ" optional="hide"/>
            </xpath>
            
            <!-- Add price columns -->
            <xpath expr="//field[@name='list_price']" position="after">
                <field name="x_ws_price" string="Giá sỉ" optional="show"/>
                <field name="x_ct_price" string="Giá vốn" optional="hide"/>
                <field name="x_tax_percent" string="Thuế %" optional="show"/>
            </xpath>
            
            <!-- Add status and warranty at end -->
            <xpath expr="//tree" position="inside">
                <field name="product_type" string="Loại" optional="show"/>
                <field name="status_product_id" string="Trạng thái" optional="hide"/>
                <field name="warranty_id" string="Bảo hành" optional="hide"/>
            </xpath>
        </field>
    </record>
    
    <!-- ========================================== -->
    <!-- SEARCH VIEW - Add VNOPTIC filters -->
    <!-- ========================================== -->
    <record id="product_template_search_view_vnoptic" model="ir.ui.view">
        <field name="name">product.template.search.vnoptic</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_search_view"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <field name="eng_name" string="Tên tiếng Anh"/>
                <field name="brand_id" string="Thương hiệu"/>
                <separator/>
                <filter string="Lens" name="filter_lens" domain="[('product_type', '=', 'lens')]"/>
                <filter string="Gọng (OPT)" name="filter_opt" domain="[('product_type', '=', 'opt')]"/>
                <filter string="Phụ kiện" name="filter_accessory" domain="[('product_type', '=', 'accessory')]"/>
                <separator/>
                <filter string="Có bảo hành" name="has_warranty" domain="[('warranty_id', '!=', False)]"/>
                <group expand="0" string="Nhóm theo">
                    <filter string="Loại SP" name="group_by_type" context="{'group_by': 'product_type'}"/>
                    <filter string="Thương hiệu" name="group_by_brand" context="{'group_by': 'brand_id'}"/>
                    <filter string="Nhà cung cấp" name="group_by_supplier" context="{'group_by': 'supplier_id'}"/>
                </group>
            </xpath>
        </field>
    </record>
    
</odoo>
